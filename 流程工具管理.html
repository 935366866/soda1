<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,Chrome=1"/>
    <title>流程工具管理</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="content-type" content="text/html" ; charset="utf-8">
    <link href="public/css/reset.css" rel="stylesheet" type="text/css" media="all"/>
    <link href="public/css/bootstrap.min.css" rel="stylesheet">
    <link href="public/css/bootstrap-table.css" rel="stylesheet">
    <link href="public/css/bootstrap-editable.css" rel="stylesheet">
    <link href="public/css/long_common.css" rel="stylesheet" type="text/css" media="all"/>
    <link href="css/soda_common.css" rel="stylesheet">
    <style type="text/css">
        .panel .columns-right button {
            height: 34px !important;
        }
        .fixed-table-container{
            padding-bottom: 40px !important;
        }
    </style>
</head>
<body style="background-color: rgb(248,248,248);">
<!--前台公共头部-->
<div class="top">
    <div class="main_nav1">
        <div class="container">
            <a href="#" class="logo"><img src="public/image/navLogo.svg"/></a>
            <ul class="main_nav1_left">
                <li id="main"><a href="main.html">首页</a></li>
                <li id="sodaIndex"><a href="sodaIndex.html">用户管理</a></li>
                <li id="frontierResearch"><a href="frontierResearch.html">流程工具管理</a></li>
                <li id="marketActive"><a href="marketActive.html">分析模块管理</a></li>
                <li id="2w"><a href="marketActive.html">硬盘挂载</a></li>
            </ul>
            <div class="form-group searchNews" id="search_news">
                <span class="col-sm-2 control-label"><img src="public/image/navSearch.svg"/></span>

                <div class="col-sm-10">
                    <input type="text" class="form-control" id="search_news_input">
                </div>
            </div>
            <ul class="main_nav1_right">
                <li id="searchIcon"><a href="#"><img src="public/image/navSearch.svg" alt="搜索"/></a></li>
                <li><a href="personalCenter.html"><img src="public/image/navUser.svg" alt="用户"/></a></li>
            </ul>
        </div>
    </div>
</div>
<!--/前台公共头部-->

<div class="change_box" style="margin-top: 120px;width: 87%;padding-right: 10px;">
    <div class="panel panel-default container " style="width:100%">
        <div id="toolbar">
            <button class="btn btn-primary " data-target="#newProject" data-toggle="modal"
                    style="background: #13438B !important;">新建流程工具
            </button>
            <button class="btn btn-warning " id="editProject">编辑</button>
            <div style="display: inline">(双击行,可增加/删除分析模块)</div>
            <!----------------------------------------------------------------------------------------------------->
            <!-- 添加项目的模态框 -->
            <div class="modal fade" id="newProject" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                &times;
                            </button>
                            <h4 class="modal-title" id="myModalLabel">新建流程工具</h4>
                        </div>
                        <form class="form-horizontal" id="submitNewPro" role="form" action="test" method="post">
                            <div class="modal-body" style=" text-align:center">
                                <div class="form-group">
                                    <label class="col-sm-3">名称*</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="project_name"
                                               name="project_name" placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">执行脚本*</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="12" name="project_name"
                                               placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">报告路径</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="23" name="project_name"
                                               placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">类别*</label>

                                    <div class="col-sm-8">
                                        <select name="" id="" class="form-control">
                                            <option value="">下拉列表</option>
                                            <option value="">输入框</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3" for="inputfile">简介</label>

                                    <div class="col-sm-8" style="height: 150px">
                                        <textarea class="form-control col-md-7" style="height:150px; resize:none"
                                                  placeholder="请输入项目说明" id="project_remark"
                                                  name="project_remark"> </textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">说明路径</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="32" name="project_name"
                                               placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">图表路径</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="22" name="project_name"
                                               placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">版本号</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="312" name="project_name"
                                               placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" onClick="submitProject()" class="btn btn-primary">新建</button>
                                <button type="button" id="cancel" class="btn btn-default" data-dismiss="modal">取消
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            <!-------------------------------------------------------------------------->
            <!-- 编辑的模态框 -->
            <div class="modal fade" id="editInfo" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                 aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                &times;
                            </button>
                            <h4 class="modal-title" id="myModalLabel1">新建流程工具</h4>
                        </div>
                        <form class="form-horizontal" id="submitNewPro1" role="form" action="test" method="post">
                            <div class="modal-body" style=" text-align:center">
                                <div class="form-group">
                                    <label class="col-sm-3">名称*</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="project_name1"
                                               name="project_name" placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">执行脚本*</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="1" name="project_name"
                                               placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">报告路径</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="2" name="project_name"
                                               placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">类别*</label>

                                    <div class="col-sm-8">
                                        <select name="" id="sd" class="form-control">
                                            <option value="">下拉列表</option>
                                            <option value="">输入框</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-md-3" for="inputfile">简介</label>

                                    <div class="col-sm-8" style="height: 150px">
                                        <textarea class="form-control col-md-7" style="height:150px; resize:none"
                                                  placeholder="请输入项目说明" id="project_remark1"
                                                  name="project_remark"> </textarea>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">说明路径</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="3112" name="project_name"
                                               placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">图表路径</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="232" name="project_name"
                                               placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="col-sm-3">版本号</label>

                                    <div class="col-sm-8">
                                        <input type="text" class="form-control col-md-7" id="3122" name="project_name"
                                               placeholder="请输入项目名称" required>
                                    </div>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="button" onClick="submitProject()" class="btn btn-primary">新建</button>
                                <button type="button" id="cancel1" class="btn btn-default" data-dismiss="modal">取消
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>

        <table data-toggle="table"
               data-url="json/myProject.json"
               data-toolbar="#toolbar"
               data-search="true"
               data-click-to-select="true"
               data-show-refresh="true"
               data-show-columns="true"
               data-height="480"
               data-side-pagination="server"
               data-sort-order="desc" id="maintable">
            <thead>
            <tr>
                <th data-checkbox="true"></th>
                <th data-field="project_name" data-align="center" data-sortable="true">名称</th>
                <th data-field="create_man" data-align="center" data-sortable="true">主脚本</th>
                <th data-field="create_time" data-align="center" data-sortable="true">报告路径</th>
                <th data-field="project_remark" data-visible="false">类别</th>
                <th data-field="id" data-visible="false">简介</th>
                <th data-field="run_num" data-align="center" data-formatter="runFormatter" data-sortable="false">使用说明
                </th>
                <th data-field="done_num" data-align="center" data-formatter="doneFormatter" data-sortable="false">图表
                </th>
                <th data-field="stop_num" data-align="center" data-formatter="stopFormatter" data-sortable="false">版本号
                </th>
            </tr>
            </thead>
        </table>
        <p>已选中<span id="now_ck_num">0</span>项</p>
    </div>
</div>
<!-- 双击后的模态框-->
    <div class="modal fade" id="parameter" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog" style="width: 1300px">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                        &times;
                    </button>
                    <h4 class="modal-title" id="myModalLabe2">RNA流程:有参转录组</h4>
                </div>
                <div style="display: inline-flex">
                    <div class="panel panel-default container " style="width: 600px;margin: 0 25px;">
                        <div id="toolbar1">
                            <div style="display: inline">包含的模块</div>
                        </div>
                        <table data-toggle="table"
                               data-url="json/myProject2.json"
                               data-toolbar="#toolbar1"
                               data-search="true"
                               data-click-to-select="true"
                               data-show-refresh="true"
                               data-show-columns="true"
                               data-height="480"
                               data-side-pagination="server"
                               data-sort-order="desc" id="maintable1">
                            <thead>
                            <tr>
                                <th data-field="state" data-checkbox="true"></th>
                                <th data-field="project_name" data-align="center" data-sortable="true">模块名称</th>
                                <th data-field="create_man" data-align="center" data-sortable="true">模块简介</th>
                                <th data-field="create_time" data-align="center" data-sortable="true">程序标识</th>
                                <th data-field="project_remark" data-align="center" data-sortable="true">是否必选
                                </th>
                            </tr>
                            </thead>
                        </table>
                        <p>已选中<span id="now_ck_num1">0</span>项</p>
                    </div>

                    <div class="panel panel-default container " style="width: 600px;margin: 0 25px;">
                        <div id="toolbar2">
                            <div style="display: inline">公共模块库</div>
                        </div>
                        <table data-toggle="table"
                               data-url="json/myProject2.json"
                               data-toolbar="#toolbar2"
                               data-search="true"
                               data-click-to-select="true"
                               data-show-refresh="true"
                               data-show-columns="true"
                               data-height="480"
                               data-side-pagination="server"
                               data-sort-order="desc" id="maintable2">
                            <thead>
                            <tr>
                                <th data-field="state" data-checkbox="true"></th>
                                <th data-field="project_name" data-align="center" data-sortable="true">模块名称</th>
                                <th data-field="create_man" data-align="center" data-sortable="true">模块简介</th>
                                <th data-field="create_time" data-align="center" data-sortable="true">程序标识</th>
                                <th data-field="project_remark" data-align="center" data-sortable="true">是否必选
                                </th>
                            </tr>
                            </thead>
                        </table>
                        <p>已选中<span id="now_ck_num2">0</span>项</p>
                    </div>
                </div>
                <div class="modal-footer" style="text-align: center;border-top: none">
                    <button type="button" class="btn btn-primary">添加模块</button>
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                </div>
            </div>
        </div>
    </div>
<!-- =============登录框============ -->
<div class="modal fade" id="loginBox" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog" style="margin-top:100px">
        <div class="modal-content col-sm-10 col-sm-push-1">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
            </div>
            <div class="modal-body" style=" text-align:center">
                <h3 class="modal-title" style="text-align: center">用户登录</h3>

                <div class="login_subtitle">
                    <p>DoDoGENE</p>
                </div>
                <form style="text-align:left" id="login_form" action="/ddgene/Home/Login/login" method='POST'>
                    <div class="input_div">
                        <input type="text" class="form-control input-lg" placeholder="输入手机或邮箱登录" id="name" name="name"
                               required>
                        <span></span>
                    </div>
                    <div class="input_div">
                        <input type="password" class="form-control input-lg" placeholder="输入密码" id="password"
                               name="password" required>
                        <span></span>
                    </div>
                    <button type="submit" class="form-control input-lg" id="login">登录</button>
                </form>
                <div class="forget">
                    <a href="/ddgene/Home/Login/change_pw_email">忘记密码》</a>

                    <p>还没有账号？
                        <a href="/ddgene/Home/Login/register">点击注册》</a>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

</div>
<!-- =============登录框结束=========== -->


<!--页脚-->
<div id="footer_style">
    <footer class="footerstyle">
        <p>版权所有 © 2016 京ICP备15033925号</p>

        <p>北京拓美科基因科技有限公司</p>
    </footer>
</div>
<script src="public/js/jquery-1.11.2.min.js"></script>
<script src="public/js/bootstrap.min.js"></script>
<script src="public/js/bootstrap-table.js"></script>
<script src="public/js/bootstrap-editable.js"></script>
<script src="public/js/long_common.js"></script>
<script src="js/common.js"></script>
<script>
    $("#maintable").bootstrapTable({
        onDblClickRow: function (row) {
            console.log(row)
            $("#parameter").modal('show');
        }
    });

    //正在运行中
    function runFormatter(index, row) {
        return '<button class="btn btn-success btn-xs">' + row.run_num + '</button>';
    }
    ;
    //完成任务
    function doneFormatter(index, row) {
        return '<button class="btn btn-primary btn-xs">' + row.done_num + '</button>';
    }
    ;
    //终止任务
    function stopFormatter(index, row) {
        return '<button class="btn btn-warning btn-xs">' + row.stop_num + '</button>';
    }
    ;


    //项目可编辑
    function edit(arr) {
        item = arr.next('.detail-view');

        pjname = item.find("a[data-name=project_name]");
        pjinfo = item.find("a[data-name=project_remark]");
        $(pjname).editable({
            type: 'text',
            url: '/ddgene/Home/Project/updateProjField',
            success: function (data) {
                if (data.status == 'ERROR') {
                    alert(data.data);
                }
            },
            error: function (response, newValue) {
                alert(response.status + ' ' + response.statusText);
            }
        });
        $(pjinfo).editable({
            type: 'text',
            url: '/ddgene/Home/Project/updateProjField',
            success: function (data) {
                if (data.status == 'ERROR') {
                    alert(data.data);
                }
            },
            error: function (response, newValue) {
                alert(response.status + ' ' + response.statusText);
            }
        });

    }
    ;

    //编辑选中的行
    $("#editProject").click(function () {
        var a = $("#maintable").bootstrapTable('getSelections');
        num = checkedNum("maintable");
        if(num==0){
            alert("请选中表格中的数据");
        }if(num==1){
            $('#editInfo').modal('show');
        }
        if(num>1){
            alert("只能选中一行数据")
        }

    });
    //新建项目
    function submitProject() {
        proData = $("#submitNewPro").serialize()
        $.post('/ddgene/Home/Project/addProj',
                proData,
                function (data, status) {
                    if (data['status'] == 'ERROR') {
                        alert(data['data']);
                        return false;
                    }
                    alert("提交成功！");
                    $("#maintable").bootstrapTable('refresh');
                    $("#newProject").modal('hide');
                    $(".modal-content").find("input").val("");
                    $(".modal-content").find("textarea").val("");
                },
                'json')
                .error(function (XMLHttpRequest) {
                    alert(XMLHttpRequest.status + ' ' + XMLHttpRequest.statusText);
                    $("#newProject").modal('hide');
                    $(".modal-content").find("input").val("");
                    $(".modal-content").find("textarea").val("");
                });
    }
    ;
    //实时统计选中checkbox的个数
    $(function () {
        checkedNow('maintable', 'now_ck_num');
    });

    //模态框点击关闭的时候清空表单
    $(function () {
        $(".close").bind("click", function () {
            $(".modal-content").find("input").val("");
            $(".modal-content").find("textarea").val("");
        });
        $("#cancel").bind("click", function () {
            $(".modal-content").find("input").val("");
            $(".modal-content").find("textarea").val("");
        });
    });

    //添加跳转到任务界面的连接
    function linkJob(name, row) {
//	console.log(row.id)//ID
        return '<a href="/ddgene/Home/Project/listProjTasks/project_id/' + row.id + '" >' + name + '</a>'
    }
    ;

    //给首页设置定时器
    $(function () {
        setInterval("rf_bsTable('maintable')", 300000);
    });
    ////ly
    //$(function(){
    //	if(user=0){
    //		$('#loginBox').modal('show');
    //	}
    //)
    //}
</script>
<script>
    $(function () {
        $('.typelist li a').hover(function () {
            $(this).css('color', '#333333')
        }, function () {
            $(this).css('color', '#959595')
        })
    })
</script>
</body>

</html>